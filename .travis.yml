language: bash

services:
  - docker

env:
  global:
    - DOCKER_USER=juniarti DOCKER_PWD=j12l18a90c PLATFORM_URL=https://9.30.245.9:6443 PLATFORM_USERNAME=kubeadmin PLATFORM_PASSWORD=4Gq4g-5m9gV-MFnAc-FiHUH
   
group: bluezone

dist: xenial

sudo: required
addons:
  apt:
    sources:
      - sourceline: 'deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable'
        key_url: 'https://download.docker.com/linux/ubuntu/gpg'
    packages:
      - docker-ce

before_install:
  - echo "Killing auto-updates to avoid apt lock conflicts";
  - sudo systemctl stop apt-daily.service;
  - sudo systemctl stop apt-daily.timer;
  - sudo systemctl stop apt-daily-upgrade.service;
  - sudo systemctl stop apt-daily-upgrade.timer;
  - sudo apt-get install -y dnsutils
  - sudo chgrp travis /var/run/docker.sock
  - docker version
  
jobs:
  include:
    - stage: build-push-images
      os: linux
      script:
      - uname -a
      - cat /etc/issue
      - wget `curl -s https://api.github.com/repos/openshift/origin/releases/latest | jq -r ".assets[] | select(.name | test(\"linux-64bit\")) | .browser_download_url" | grep -i client-tools`
      - tar xvfz `ls openshift-origin-client-tools-*.tar.gz` --strip-components=1 -C $HOME/bin
      - oc version
      - ./setupAppNavTestEnv.sh
    
    
